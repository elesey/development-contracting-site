---
interface Partner {
  name: string;
  tagline?: string;
}

const partners: Partner[] = [
  { name: "Kohler", tagline: "Kitchen & Bath" },
  { name: "Moen", tagline: "Fixtures" },
  { name: "Delta", tagline: "Faucets" },
  { name: "American Standard", tagline: "Plumbing" },
  { name: "Toto", tagline: "Toilets" },
  { name: "Andersen", tagline: "Windows" },
  { name: "Pella", tagline: "Doors & Windows" },
  { name: "Milgard", tagline: "Windows" },
  { name: "James Hardie", tagline: "Siding" },
  { name: "GAF", tagline: "Roofing" },
  { name: "CertainTeed", tagline: "Building Materials" },
  { name: "Shaw Floors", tagline: "Flooring" },
];

// Duplicate for seamless loop
const allPartners = [...partners, ...partners];
---

<section
  class="marquee-section border-border/30 bg-secondary/30 relative overflow-hidden border-y py-12"
>
  <!-- Subtle texture -->
  <div class="texture-grain absolute inset-0"></div>

  <!-- Fade edges -->
  <div
    class="from-background pointer-events-none absolute top-0 left-0 z-10 h-full w-32 bg-gradient-to-r to-transparent"
  >
  </div>
  <div
    class="from-background pointer-events-none absolute top-0 right-0 z-10 h-full w-32 bg-gradient-to-l to-transparent"
  >
  </div>

  <!-- Header -->
  <div class="container mx-auto mb-8 px-6 text-center">
    <span class="text-muted-foreground text-xs tracking-[0.3em] uppercase">
      Trusted Partners & Brands We Work With
    </span>
  </div>

  <!-- Marquee container -->
  <div class="marquee-wrapper relative flex overflow-hidden">
    <div class="marquee-track flex shrink-0 items-center gap-16 pr-16">
      {
        allPartners.map((partner) => (
          <div class="partner-item flex flex-col items-center">
            {/* Logo placeholder with text - fixed dimensions to prevent layout shift */}
            <div class="border-border/50 bg-card/50 flex h-16 w-40 items-center justify-center rounded border px-4">
              <span class="text-foreground/80 font-serif text-lg font-medium">
                {partner.name}
              </span>
            </div>
            {partner.tagline && (
              <span class="text-muted-foreground/60 mt-2 text-[10px] tracking-widest uppercase">
                {partner.tagline}
              </span>
            )}
          </div>
        ))
      }
    </div>
  </div>
</section>

<style>
  /* Animation created via JS - this just sets up performance hints */
  .marquee-track {
    will-change: transform;
  }

  /* Hover effects on individual cards - only colors, no layout changes */
  .partner-item > div {
    transition:
      border-color 0.3s ease,
      background-color 0.3s ease;
  }

  .partner-item:hover > div {
    border-color: hsl(28 65% 52% / 0.3);
    background-color: hsl(30 12% 10%);
  }

  .partner-item > div > span {
    transition: color 0.3s ease;
  }

  .partner-item:hover > div > span {
    color: hsl(28 65% 52%);
  }
</style>

<script>
  // Smooth ease-to-stop marquee using Web Animations API only (no CSS animation)
  const section = document.querySelector(".marquee-section");
  const track = document.querySelector(".marquee-track") as HTMLElement | null;

  if (section && track) {
    // Create animation exclusively via JS - no CSS animation to conflict
    const animation = track.animate(
      [{ transform: "translateX(0)" }, { transform: "translateX(-50%)" }],
      { duration: 30000, iterations: Infinity, easing: "linear" },
    );

    let targetSpeed = 1;
    let currentSpeed = 1;
    let frameId: number | null = null;

    const updateSpeed = () => {
      // Ease towards target (0.12 = ~200ms to stop/start)
      currentSpeed += (targetSpeed - currentSpeed) * 0.12;

      // Snap when close enough
      if (Math.abs(currentSpeed - targetSpeed) < 0.001) {
        currentSpeed = targetSpeed;
        animation.playbackRate = currentSpeed;
        frameId = null;
        return;
      }

      animation.playbackRate = currentSpeed;
      frameId = requestAnimationFrame(updateSpeed);
    };

    section.addEventListener("mouseenter", () => {
      targetSpeed = 0;
      if (!frameId) frameId = requestAnimationFrame(updateSpeed);
    });

    section.addEventListener("mouseleave", () => {
      targetSpeed = 1;
      if (!frameId) frameId = requestAnimationFrame(updateSpeed);
    });
  }
</script>
